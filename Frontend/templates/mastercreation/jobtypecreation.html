{% extends "nav.html" %}
{% block title %}Job Type Creation{% endblock %}

{% block extra_head %}
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-slate-50 via-teal-50/30 to-cyan-50/30 p-6">

<div class="max-w-[1600px] mx-auto space-y-6">

<!-- HEADER -->
<div class="bg-gradient-to-r from-teal-600 to-cyan-600 rounded-xl p-6 flex justify-between items-center shadow">
  <div class="flex items-center gap-3">
    <i data-lucide="briefcase" class="text-white"></i>
    <h1 class="text-2xl font-bold text-white">Job Type Creation</h1>
  </div>
  <button onclick="openModal()"
    class="bg-white text-teal-600 px-4 py-2 rounded-lg font-semibold">
    + New Job Type
  </button>
</div>

<!-- DESKTOP TABLE -->
<div class="hidden md:block bg-white rounded-xl shadow overflow-x-auto">
<table class="w-full text-sm">
<thead class="bg-slate-100">
<tr>
  <th class="p-3">S.No</th>
  <th class="p-3 text-left">Job Type Name</th>
  <th class="p-3 text-center">Media Entry</th>
  <th class="p-3 text-center">Printer Production</th>
  <th class="p-3 text-center">Fusing Production</th>
  <th class="p-3 text-center">Edit</th>
  <th class="p-3 text-center">Delete</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>
</div>

<!-- MOBILE CARDS -->
<div id="cards" class="grid gap-4 md:hidden"></div>

</div>

<!-- MODAL -->
<div id="modal" class="fixed inset-0 bg-black/40 hidden items-center justify-center z-50">
<div class="bg-white rounded-xl w-full max-w-md p-6 shadow-xl">

<h2 class="text-lg font-bold mb-4">Job Type</h2>

<input id="jobType"
  placeholder="Job Type Name *"
  class="w-full border p-2 rounded mb-4">

<div class="space-y-3">
  <label class="flex items-center gap-2">
    <input type="checkbox" id="media">
    <span>Media Entry</span>
  </label>

  <label class="flex items-center gap-2">
    <input type="checkbox" id="printer">
    <span>Printer Production</span>
  </label>

  <label class="flex items-center gap-2">
    <input type="checkbox" id="fusing">
    <span>Fusing Production</span>
  </label>
</div>

<div class="flex justify-end gap-3 mt-5">
  <button onclick="closeModal()" class="px-4 py-2 border rounded">
    Cancel
  </button>
  <button onclick="saveJobType()"
    class="px-6 py-2 bg-teal-600 text-white rounded">
    Save
  </button>
</div>

</div>
</div>
</div>
{% endblock %}

{% block extra_js %}
<script>
lucide.createIcons()

let jobTypes = [
 { name:"Flex Printing", media:true, printer:true, fusing:false },
 { name:"Sticker", media:true, printer:true, fusing:true }
]

let editIndex = null

function badge(val){
 return val
  ? '<span class="text-green-600 font-semibold">Yes</span>'
  : '<span class="text-red-500">No</span>'
}

function renderUI(){
 const tbody = document.getElementById("tableBody")
 const cards = document.getElementById("cards")
 tbody.innerHTML = ""
 cards.innerHTML = ""

 jobTypes.forEach((j,i)=>{
  // TABLE
  tbody.innerHTML += `
  <tr class="border-t hover:bg-slate-50">
    <td class="p-3">${i+1}</td>
    <td class="p-3">${j.name}</td>
    <td class="p-3 text-center">${badge(j.media)}</td>
    <td class="p-3 text-center">${badge(j.printer)}</td>
    <td class="p-3 text-center">${badge(j.fusing)}</td>
    <td class="p-3 text-center text-emerald-600 cursor-pointer"
      onclick="editJobType(${i})">‚úèÔ∏è</td>
    <td class="p-3 text-center text-red-500 cursor-pointer"
      onclick="deleteJobType(${i})">üóëÔ∏è</td>
  </tr>`

  // MOBILE CARD
  cards.innerHTML += `
  <div class="bg-white rounded-xl shadow p-4">
    <h3 class="font-bold text-lg">${j.name}</h3>
    <p class="text-sm">Media Entry: ${badge(j.media)}</p>
    <p class="text-sm">Printer Production: ${badge(j.printer)}</p>
    <p class="text-sm">Fusing Production: ${badge(j.fusing)}</p>
    <div class="flex justify-end gap-4 mt-3">
      <button onclick="editJobType(${i})" class="text-teal-600">Edit</button>
      <button onclick="deleteJobType(${i})" class="text-red-500">Delete</button>
    </div>
  </div>`
 })
}

function openModal(){
 modal.classList.remove("hidden")
 modal.classList.add("flex")
}

function closeModal(){
 modal.classList.add("hidden")
 editIndex = null
 jobType.value = ""
 media.checked = false
 printer.checked = false
 fusing.checked = false
}

function saveJobType(){
 if(!jobType.value.trim()){
  alert("Job Type Name is required")
  return
 }

 const obj = {
  name: jobType.value.trim(),
  media: media.checked,
  printer: printer.checked,
  fusing: fusing.checked
 }

 if(editIndex !== null){
  jobTypes[editIndex] = obj
 } else {
  jobTypes.push(obj)
 }

 closeModal()
 renderUI()
}

function editJobType(i){
 editIndex = i
 jobType.value = jobTypes[i].name
 media.checked = jobTypes[i].media
 printer.checked = jobTypes[i].printer
 fusing.checked = jobTypes[i].fusing
 openModal()
}

function deleteJobType(i){
 if(confirm("Delete this job type?")){
  jobTypes.splice(i,1)
  renderUI()
 }
}

renderUI()
</script>
{% endblock %}
