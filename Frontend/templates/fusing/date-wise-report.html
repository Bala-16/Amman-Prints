{% extends "nav.html" %}

{% block title %}Job Card List{% endblock %}

{% block extra_head %}
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-slate-50 via-emerald-50/30 to-teal-50/30 p-4 sm:p-6">
  <div class="max-w-[1700px] mx-auto space-y-6">

    <!-- HEADER -->
    <div class="bg-gradient-to-r from-emerald-600 via-teal-600 to-emerald-600 rounded-xl p-6 shadow-xl
         flex flex-col sm:flex-row sm:items-center gap-4">

      <!-- icon + title -->
      <div class="flex items-start gap-4">
        <div class="h-12 w-12 rounded-xl bg-white/20 flex items-center justify-center flex-shrink-0">
          <i data-lucide="calendar-range" class="text-white w-6 h-6"></i>
        </div>

        <div>
          <h1 class="text-2xl font-bold text-white">Date Wise Production Report</h1>
          <p class="text-teal-100 text-sm">Production summary by date</p>
        </div>
      </div>

      <!-- Print button (mobile கீழே / desktop right) -->
      <button onclick="window.print()" class="bg-white text-teal-600 px-3 py-2 rounded-lg shadow flex items-center gap-2
         hover:scale-105 transition
         self-start sm:self-auto sm:ml-auto">
        <i data-lucide="printer" class="w-4 h-4"></i>
        Print Report
      </button>

    </div>

    <!-- FILTER -->
    <div class="bg-white/80 backdrop-blur rounded-xl shadow-lg p-4 sm:p-6 grid grid-cols-1 md:grid-cols-5 gap-4">
      <div>
        <label class="text-sm">From Date</label>
        <input type="date" id="fromDate" class="w-full border rounded px-3 py-2">
      </div>
      <div>
        <label class="text-sm">To Date</label>
        <input type="date" id="toDate" class="w-full border rounded px-3 py-2">
      </div>
      <div>
        <label class="text-sm">Machine</label>
        <input type="text" id="machine" placeholder="GT-1" class="w-full border rounded px-3 py-2">
      </div>
      <div>
        <label class="text-sm">Operator</label>
        <input type="text" id="operator" placeholder="SENTHIL" class="w-full border rounded px-3 py-2">
      </div>
      <div class="flex items-end gap-2">
        <button id="searchBtn"
          class="bg-teal-600 text-white px-6 py-2 rounded-lg shadow hover:scale-105 transition flex items-center gap-2">
          <i data-lucide="search" class="w-4 h-4"></i> Search
        </button>
        <button id="resetBtn" class="bg-gray-300 text-gray-700 px-6 sm:px-6 py-2 rounded-lg flex items-center gap-2
         border border-gray-200 hover:scale-105 transition">
          <i data-lucide="refresh-cw" class="w-4 h-4"></i>
          Reset
        </button>
      </div>
    </div>

    <!-- CHARTS -->
    <!-- <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div class="bg-white/80 backdrop-blur rounded-xl shadow-lg p-6 sm:p-10 h-[300px]">
        <h3 class="font-semibold mb-4">Date Wise Produced Quantity</h3>
        <canvas id="dateBar"></canvas>
      </div>

      <div class="bg-white/80 backdrop-blur rounded-xl shadow-lg p-6 sm:p-10 h-[300px]">
        <h3 class="font-semibold mb-4">Production Share by Date</h3>
        <canvas id="datePie"></canvas>
      </div>
    </div> -->

    <!-- TABLE -->
    <div class="bg-white/80 backdrop-blur rounded-xl shadow-lg overflow-x-auto">
      <div class="p-4 border-b text-sm text-slate-600">
        Total Records: <span id="count">0</span>
      </div>

      <table class="w-full text-sm min-w-[900px]">
        <thead class="bg-slate-100">
          <tr>
            <th class="p-3 text-left">S.No</th>
            <th class="p-3 text-left">Date</th>
            <th class="p-3 text-left">Jobcard</th>
            <th class="p-3 text-left">Customer</th>
            <th class="p-3 text-left">Shift</th>
            <th class="p-3 text-left">Operator</th>
            <th class="p-3 text-left">Machine</th>
            <th class="p-3 text-left">Particulars</th>
            <th class="p-3 text-right">Produced Qty</th>
          </tr>
        </thead>
        <tbody id="tableBody"></tbody>
      </table>
    </div>

  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  lucide.createIcons();

  // Sample data
  let rows = [
    { date: "10-04-2024", jc: "JC-2404-0085", cust: "RHYTHM KNIT INDIA", shift: "DAY", op: "SENTHIL", mach: "GT-1", part: "2XL TOP", qty: 225 },
    { date: "10-04-2024", jc: "JC-2404-0085", cust: "RHYTHM KNIT INDIA", shift: "DAY", op: "SENTHIL", mach: "GT-1", part: "AOP BOTTOM", qty: 3500 },
    { date: "10-04-2024", jc: "JC-2404-0086", cust: "RHYTHM KNIT INDIA", shift: "DAY", op: "SENTHIL", mach: "GT-1", part: "L TOP", qty: 500 },
    { date: "12-04-2024", jc: "JC-2404-0095", cust: "STAG EXPORTS", shift: "DAY", op: "HARI", mach: "ORIC-1", part: "32-GREEN", qty: 14 },
    { date: "12-04-2024", jc: "JC-2404-0095", cust: "STAG EXPORTS", shift: "DAY", op: "HARI", mach: "ORIC-1", part: "34-BLUE", qty: 22 },
    { date: "12-04-2024", jc: "JC-2404-0097", cust: "JAWAN KNIT", shift: "DAY", op: "HARI", mach: "ORIC-1", part: "FRONT", qty: 470 }
  ];

  const tbody = document.getElementById("tableBody");
  const countEl = document.getElementById("count");

  const fromDate = document.getElementById("fromDate");
  const toDate = document.getElementById("toDate");
  const machineInput = document.getElementById("machine");
  const operatorInput = document.getElementById("operator");

  const searchBtn = document.getElementById("searchBtn");
  const resetBtn = document.getElementById("resetBtn");

  // Charts
  const barCtx = document.getElementById("dateBar").getContext("2d");
  const pieCtx = document.getElementById("datePie").getContext("2d");

  let barChart = new Chart(barCtx, {
    type: "bar",
    data: { labels: [], datasets: [{ label: "Produced Qty", data: [], backgroundColor: "#059669", borderRadius: 6 }] },
    options: { maintainAspectRatio: false, scales: { y: { beginAtZero: true } } }
  });

  let pieChart = new Chart(pieCtx, {
    type: "doughnut",
    data: { labels: [], datasets: [{ data: [], backgroundColor: ["#059669", "#10b981", "#34d399", "#6ee7b7"] }] },
    options: { maintainAspectRatio: false }
  });

  // Render table and charts
  function renderTable(data) {
    tbody.innerHTML = "";
    let dateMap = {};
    let totalQty = 0;

    data.forEach((r, i) => {
      tbody.innerHTML += `
      <tr class="border-t hover:bg-slate-50">
        <td class="p-2 sm:p-3">${i + 1}</td>
        <td class="p-2 sm:p-3">${r.date}</td>
        <td class="p-2 sm:p-3 font-medium">${r.jc}</td>
        <td class="p-2 sm:p-3">${r.cust}</td>
        <td class="p-2 sm:p-3">${r.shift}</td>
        <td class="p-2 sm:p-3">${r.op}</td>
        <td class="p-2 sm:p-3">${r.mach}</td>
        <td class="p-2 sm:p-3">${r.part}</td>
        <td class="p-2 sm:p-3 text-right">${r.qty}</td>
      </tr>`;

      dateMap[r.date] = (dateMap[r.date] || 0) + r.qty;
      totalQty += r.qty;
    });

    countEl.innerText = data.length;

    barChart.data.labels = Object.keys(dateMap);
    barChart.data.datasets[0].data = Object.values(dateMap);
    barChart.update();

    pieChart.data.labels = Object.keys(dateMap);
    pieChart.data.datasets[0].data = Object.values(dateMap);
    pieChart.update();
  }

  // Initial render
  renderTable(rows);

  // Search
  searchBtn.addEventListener("click", () => {
    const from = fromDate.value;
    const to = toDate.value;
    const mach = machineInput.value.trim().toLowerCase();
    const op = operatorInput.value.trim().toLowerCase();

    const filtered = rows.filter(r => {
      let valid = true;
      if (from) valid = valid && r.date >= from;
      if (to) valid = valid && r.date <= to;
      if (mach) valid = valid && r.mach.toLowerCase().includes(mach);
      if (op) valid = valid && r.op.toLowerCase().includes(op);
      return valid;
    });

    renderTable(filtered);
  });

  // Reset
  resetBtn.addEventListener("click", () => {
    fromDate.value = ""; toDate.value = ""; machineInput.value = ""; operatorInput.value = "";
    renderTable(rows);
  });
</script>
{% endblock %}