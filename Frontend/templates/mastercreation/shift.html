{%extends "nav.html"%}
{%block title%}Shift Creation{%endblock%}
{%block extra_head%}
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
{%endblock%}
{%block content%}
<div class="bg-slate-50 min-h-screen p-4">

<div class="max-w-7xl mx-auto space-y-6">

<!-- HEADER -->
<!-- <div class="bg-gradient-to-r from-teal-600 to-cyan-600 rounded-xl p-6 flex justify-between items-center">
  <div class="flex items-center gap-3">
    <i data-lucide="clock" class="text-white"></i>
    <h1 class="text-xl font-bold text-white">Shift Creation</h1>
  </div>
  <button onclick="openDialog()"
    class="bg-white text-teal-600 px-4 py-2 rounded font-semibold">
    + New Shift
  </button>
</div> -->
<!-- HEADER -->
<div class="bg-gradient-to-r from-teal-600 to-cyan-600 rounded-xl p-6">
  <div class="flex flex-col gap-4 sm:flex-row sm:justify-between sm:items-center">

    <div class="flex items-center gap-3">
      <i data-lucide="clock" class="text-white"></i>
      <h1 class="text-xl font-bold text-white">Shift Creation</h1>
    </div>

    <button onclick="openDialog()"
      class="bg-white text-teal-600 px-4 py-2 rounded font-semibold w-fit">
      + New Shift
    </button>

  </div>
</div>

<!-- DESKTOP TABLE -->
<div class="hidden md:block bg-white rounded-xl shadow overflow-x-auto">
<table class="w-full text-sm">
<thead class="bg-slate-100">
<tr>
  <th class="p-3 text-left">#</th>
  <th class="p-3">From</th>
  <th class="p-3">To</th>
  <th class="p-3">Shift</th>
  <th class="p-3">Description</th>
  <th class="p-3 text-center">Edit</th>
  <th class="p-3 text-center">Delete</th>
</tr>
</thead>
<tbody id="shiftTable"></tbody>
</table>
</div>

<!-- MOBILE CARDS -->
<div id="shiftCards" class="grid gap-4 md:hidden"></div>

</div>

<!-- DIALOG -->
<div id="dialog"
  class="fixed inset-0 bg-black/40 hidden items-center justify-center z-50">

<div class="bg-white rounded-xl w-full max-w-md p-6">
<h2 class="text-lg font-bold mb-4">Shift</h2>

<div class="space-y-3">
  <input type="time" id="fromTime" class="w-full border p-2 rounded">
  <input type="time" id="toTime" class="w-full border p-2 rounded">
  <input id="shiftName" placeholder="Shift Name" class="w-full border p-2 rounded">
  <input id="description" placeholder="Description" class="w-full border p-2 rounded">
</div>

<div class="flex justify-end gap-3 mt-5">
  <button onclick="closeDialog()" class="px-4 py-2 border rounded">Cancel</button>
  <button onclick="saveShift()" class="px-6 py-2 bg-teal-600 text-white rounded">
    Save
  </button>
</div>
</div>
</div>
</div>
{%endblock%}
{%block extra_js%}
<script>
lucide.createIcons()

let shifts = [
 { from:"09:00", to:"21:00", name:"DAY SHIFT", desc:"" },
 { from:"21:00", to:"09:00", name:"NIGHT SHIFT", desc:"" }
]

let editIndex = null

function renderUI(){
 const table = document.getElementById("shiftTable")
 const cards = document.getElementById("shiftCards")
 table.innerHTML = ""
 cards.innerHTML = ""

 shifts.forEach((s,i)=>{
  // TABLE
  table.innerHTML += `
  <tr class="border-t">
    <td class="p-3">${i+1}</td>
    <td class="p-3">${s.from}</td>
    <td class="p-3">${s.to}</td>
    <td class="p-3 font-medium">${s.name}</td>
    <td class="p-3">${s.desc || "-"}</td>
    <td class="p-3 text-center cursor-pointer text-emerald-600"
        onclick="editShift(${i})">‚úèÔ∏è</td>
    <td class="p-3 text-center cursor-pointer text-red-500"
        onclick="deleteShift(${i})">üóëÔ∏è</td>
  </tr>
  `

  // MOBILE CARD
  cards.innerHTML += `
  <div class="bg-white rounded-xl shadow p-4">
    <h3 class="font-bold">${s.name}</h3>
    <p class="text-sm text-slate-600">${s.from} ‚Üí ${s.to}</p>
    <p class="text-sm">${s.desc || "-"}</p>
    <div class="flex justify-end gap-4 mt-3">
      <button onclick="editShift(${i})" class="text-teal-600">Edit</button>
      <button onclick="deleteShift(${i})" class="text-red-500">Delete</button>
    </div>
  </div>
  `
 })
}

function openDialog(){
 dialog.classList.remove("hidden")
 dialog.classList.add("flex")
}

function closeDialog(){
 dialog.classList.add("hidden")
 editIndex = null
 fromTime.value = ""
 toTime.value = ""
 shiftName.value = ""
 description.value = ""
}

function saveShift(){
 if(!fromTime.value || !toTime.value || !shiftName.value){
  alert("Required fields missing")
  return
 }

 const data = {
  from: fromTime.value,
  to: toTime.value,
  name: shiftName.value,
  desc: description.value
 }

 if(editIndex !== null){
  shifts[editIndex] = data
 } else {
  shifts.push(data)
 }

 closeDialog()
 renderUI()
}

function editShift(i){
 editIndex = i
 const s = shifts[i]
 fromTime.value = s.from
 toTime.value = s.to
 shiftName.value = s.name
 description.value = s.desc
 openDialog()
}

function deleteShift(i){
 if(confirm("Delete this shift?")){
  shifts.splice(i,1)
  renderUI()
 }
}

renderUI()
</script>

{%endblock%}
