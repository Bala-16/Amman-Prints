{% extends "nav.html" %}
{% block title %}Printer Customer{% endblock %}

{% block extra_head %}
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>

<style>
  @media print {
    body * {
      visibility: hidden;
    }

    #printArea,
    #printArea * {
      visibility: visible;
    }

    #printArea {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
    }
  }

  /* CARD */
  .cardBox {
    background: rgba(255, 255, 255, .85);
    backdrop-filter: blur(8px);
    border-radius: 18px;
    box-shadow: 0 16px 34px rgba(15, 23, 42, .08);
    border: 1px solid rgba(226, 232, 240, .9);
  }

  /* INPUT */
  .inputBox {
    height: 56px;
    border-radius: 12px;
    border: 1px solid #e5e7eb;
    padding: 0 16px;
    outline: none;
    width: 100%;
    font-size: 18px;
  }

  .inputBox:focus {
    border-color: #14b8a6;
    box-shadow: 0 0 0 4px rgba(20, 184, 166, .15);
  }

  /* BUTTONS */
  .btnBig {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    height: 56px;
    min-width: 220px;
    padding: 0 30px;
    border-radius: 18px;
    font-weight: 800;
    cursor: pointer;
    transition: .18s ease;
  }

  .btnBig svg {
    width: 22px;
    height: 22px;
  }

  .btnSearch {
    background: #0f8b66;
    color: #fff;
  }

  .btnReset {
    background: #e5e7eb;
    color: #111827;
  }

  /* TABLE */
  .tbl thead th {
    background: #f3f6f9;
    font-weight: 800;
    border-bottom: 1px solid #e2e8f0;
    white-space: nowrap;
  }

  .tbl td {
    border-bottom: 1px solid #eef2f7;
  }

  .emptyMsg {
    padding: 20px 0;
    text-align: center;
    color: #64748b;
    font-size: 16px;
  }

  /* ✅ ALERT (NEW) */
  .alertBox {
    display: none;
    margin-bottom: 16px;
    padding: 14px 16px;
    border-radius: 14px;
    font-weight: 800;
    align-items: center;
    gap: 12px;
    border: 1px solid rgba(239, 68, 68, .25);
    background: rgba(239, 68, 68, .10);
    color: #991b1b;
  }

  .alertBox.show {
    display: flex;
  }

  .alertBox svg {
    width: 20px;
    height: 20px;
  }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-slate-50 via-teal-50/30 to-cyan-50/30 p-6">
  <div class="max-w-[1700px] mx-auto space-y-6" id="printArea">

    <!-- ✅ FILTER : SINGLE LINE -->
    <div class="cardBox p-6">

      <!-- ✅ ALERT (NEW) -->
      <div id="alertBox" class="alertBox">
        <i data-lucide="alert-triangle"></i>
        <span id="alertMsg">Message</span>
      </div>

      <div class="flex items-end gap-6">

        <!-- Jobcard -->
        <div class="flex-1 max-w-[720px]">
          <label class="text-sm text-slate-700 font-semibold">Jobcard No</label>
          <input id="jobcardInput" class="inputBox mt-2" placeholder="Enter Jobcard No" />
        </div>

        <!-- ✅ Buttons group → LAST (right end) -->
        <div class="ml-auto flex items-end gap-6">
          <!-- Search -->
          <button class="btnBig btnSearch" onclick="searchJobcard()">
            <i data-lucide="search"></i>
            Search
          </button>

          <!-- Reset -->
          <button class="btnBig btnReset" onclick="resetJobcard()">
            <i data-lucide="rotate-ccw"></i>
            Reset
          </button>
        </div>

      </div>
    </div>

    <!-- ✅ TABLE -->
    <div class="cardBox overflow-x-auto">
      <table class="tbl w-full min-w-[1200px] text-sm">
        <thead>
          <tr>
            <th class="px-4 py-4 text-left">S.No</th>
            <th class="px-4 py-4 text-left">Date</th>
            <th class="px-4 py-4 text-left">Jobcard No</th>
            <th class="px-4 py-4 text-left">Shift</th>
            <th class="px-4 py-4 text-left">Machine No</th>
            <th class="px-4 py-4 text-left">Operator Name</th>
            <th class="px-4 py-4 text-left">Particular</th>
            <th class="px-4 py-4 text-right">Order Qty</th>
            <th class="px-4 py-4 text-right">Product Qty</th>
            <th class="px-4 py-4 text-right">Balance Qty</th>
          </tr>
        </thead>

        <tbody id="jobcardBody">
          <tr>
            <td colspan="10" class="emptyMsg">
              Enter Jobcard No to view records
            </td>
          </tr>
        </tbody>

        <tfoot class="font-extrabold">
          <tr>
            <td colspan="7" class="px-4 py-4 text-right">Total</td>
            <td class="px-4 py-4 text-right" id="tOrder">0.00</td>
            <td class="px-4 py-4 text-right" id="tProd">0.00</td>
            <td class="px-4 py-4 text-right" id="tBal">0.00</td>
          </tr>
        </tfoot>
      </table>
    </div>

  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  lucide.createIcons();

  // Demo Data
  const DATA = [
    { date: "10-04-2024", job: "JC-2404-0004", shift: "DAY", machine: "GT-1", op: "SENTHIL", part: "2XL TOP", oq: 225, pq: 225 },
    { date: "10-04-2024", job: "JC-2404-0004", shift: "DAY", machine: "GT-1", op: "SENTHIL", part: "AOP BOTTOM", oq: 3500, pq: 3500 },
    { date: "10-04-2024", job: "JC-2404-0004", shift: "DAY", machine: "GT-1", op: "SENTHIL", part: "L TOP", oq: 500, pq: 500 },
  ];

  function showAlert(msg) {
    const box = document.getElementById("alertBox");
    const txt = document.getElementById("alertMsg");
    txt.innerText = msg;
    box.classList.add("show");
    // auto hide after 2.5 sec
    clearTimeout(window.__alertTimer);
    window.__alertTimer = setTimeout(() => box.classList.remove("show"), 2500);
  }

  function searchJobcard() {
    const val = jobcardInput.value.trim();
    const body = jobcardBody;
    body.innerHTML = "";

    // ✅ EMPTY → ALERT
    if (!val) {
      showAlert("Please enter Jobcard No");
      body.innerHTML = `<tr><td colspan="10" class="emptyMsg">Enter Jobcard No to view records</td></tr>`;
      setTotal(0, 0, 0);
      return;
    }

    let rows = DATA.filter(d => d.job === val);

    // ✅ WRONG → ALERT
    if (rows.length === 0) {
      showAlert("Invalid Jobcard No");
      body.innerHTML = `<tr><td colspan="10" class="emptyMsg">No records found for <b>${val}</b></td></tr>`;
      setTotal(0, 0, 0);
      return;
    }

    let to = 0, tp = 0, tb = 0;

    rows.forEach((r, i) => {
      let bal = r.oq - r.pq;
      to += r.oq; tp += r.pq; tb += bal;

      body.innerHTML += `
      <tr>
        <td class="px-4 py-4">${i + 1}</td>
        <td class="px-4 py-4">${r.date}</td>
        <td class="px-4 py-4">${r.job}</td>
        <td class="px-4 py-4">${r.shift}</td>
        <td class="px-4 py-4">${r.machine}</td>
        <td class="px-4 py-4">${r.op}</td>
        <td class="px-4 py-4">${r.part}</td>
        <td class="px-4 py-4 text-right">${r.oq.toFixed(2)}</td>
        <td class="px-4 py-4 text-right">${r.pq.toFixed(2)}</td>
        <td class="px-4 py-4 text-right">${bal.toFixed(2)}</td>
      </tr>`;
    });

    setTotal(to, tp, tb);
  }

  function resetJobcard() {
    jobcardInput.value = "";
    document.getElementById("alertBox").classList.remove("show");

    jobcardBody.innerHTML = `<tr><td colspan="10" class="emptyMsg">
      Enter Jobcard No to view records</td></tr>`;

    setTotal(0, 0, 0);
  }

  function setTotal(o, p, b) {
    tOrder.innerText = o.toFixed(2);
    tProd.innerText = p.toFixed(2);
    tBal.innerText = b.toFixed(2);
  }

  // ✅ optional: Enter key press → search
  jobcardInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") searchJobcard();
  });
</script>
{% endblock %}