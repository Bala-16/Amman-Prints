{% extends "nav.html" %}

{% block title %}Job Card List{% endblock %}

{% block extra_head %}
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-slate-50 via-teal-50/30 to-cyan-50/30 p-6">
  <div class="max-w-[1600px] mx-auto space-y-6">

    <!-- HEADER -->
    <div class="bg-gradient-to-r from-teal-600 via-cyan-600 to-teal-600 rounded-xl p-6 shadow-xl flex justify-between items-center">
      <div>
        <h1 class="text-2xl font-bold text-white">Fusing Production</h1>
        <p class="text-teal-100 text-sm">Manage daily fusing production</p>
      </div>
      <button onclick="openAddModal()"
        class="bg-white text-teal-600 px-4 py-2 rounded-lg flex items-center gap-2">
        <i data-lucide="plus"></i> New Entry
      </button>
    </div>

    <!-- TABLE (Desktop / Tablet) -->
    <div class="bg-white/80 rounded-xl shadow hidden sm:block">
      <div class="p-4 text-sm">Found <span id="recordCount">0</span> Records</div>
      <table class="w-full text-sm">
        <thead class="bg-slate-100">
          <tr>
            <th class="p-3 text-left">Date</th>
            <th class="p-3">Shift</th>
            <th class="p-3">Jobcard</th>
            <th class="p-3">Machine</th>
            <th class="p-3">Operator</th>
            <th class="p-3 text-right">Qty</th>
            <th class="p-3 text-center">Edit</th>
            <th class="p-3 text-center">Delete</th>
          </tr>
        </thead>
        <tbody id="productionTable"></tbody>
      </table>
    </div>

    <!-- MOBILE CARDS -->
    <div id="mobileCards" class="sm:hidden space-y-4"></div>

  </div>

  <!-- MODAL -->
  <div id="modal" class="fixed inset-0 bg-black/40 hidden items-center justify-center z-50">
    <div class="bg-white w-full max-w-lg rounded-xl p-6 shadow-xl">
      <h2 id="modalTitle" class="text-xl font-bold mb-4">Fusing Production Entry</h2>

      <div class="grid grid-cols-2 gap-4">
        <input type="date" id="date" class="border p-2 rounded">
        <select id="shift" class="border p-2 rounded">
          <option>DAY</option>
          <option>NIGHT</option>
        </select>
        <input id="jobcard" placeholder="Jobcard No" class="border p-2 rounded">
        <select id="machine" class="border p-2 rounded">
          <option>FLAT BED NO 1</option>
          <option>FLAT BED NO 2</option>
        </select>
        <input id="operator" placeholder="Operator" class="border p-2 rounded">
        <input id="qty" type="number" placeholder="Qty" class="border p-2 rounded">
      </div>

      <div class="flex justify-center gap-4 mt-6">
        <button onclick="closeModal()" class="border px-6 py-2 rounded">Cancel</button>
        <button onclick="saveProduction()" id="saveBtn"
          class="bg-[#9cb916] text-white px-8 py-2 rounded">ADD</button>
      </div>
    </div>
  </div>

</div>
{% endblock %}

{% block extra_js %}
<script>
lucide.createIcons()

// INITIAL DATA
let productions = [
 {date:"2024-04-03",shift:"DAY",jobcard:"JC-001",machine:"FLAT BED NO 1",operator:"GOLU",qty:300},
 {date:"2024-04-03",shift:"NIGHT",jobcard:"JC-002",machine:"FLAT BED NO 2",operator:"RAVI",qty:300}
]

let editIndex = null

// RENDER TABLE & MOBILE CARDS
function renderTable(){
 productionTable.innerHTML=""
 mobileCards.innerHTML=""

 productions.forEach((p,i)=>{
  // Desktop / Tablet
  productionTable.innerHTML+=`
   <tr class="border-t hover:bg-slate-50">
    <td class="p-3">${p.date}</td>
    <td class="p-3">${p.shift}</td>
    <td class="p-3">${p.jobcard}</td>
    <td class="p-3">${p.machine}</td>
    <td class="p-3">${p.operator}</td>
    <td class="p-3 text-right">${p.qty}</td>
    <td class="text-center text-emerald-600 cursor-pointer">
      <i data-lucide="edit" onclick="openEditModal(${i})"></i>
    </td>
    <td class="text-center text-red-500 cursor-pointer">
      <i data-lucide="trash-2" onclick="deleteProduction(${i})"></i>
    </td>
   </tr>`

  // Mobile cards
  mobileCards.innerHTML+=`
   <div class="bg-white rounded-xl shadow p-4">
    <div class="flex justify-between">
     <div>
      <p class="font-semibold">${p.jobcard}</p>
      <p class="text-sm">${p.date} • ${p.shift}</p>
     </div>
     <div class="flex gap-3">
      <i data-lucide="edit" class="text-emerald-600 cursor-pointer" onclick="openEditModal(${i})"></i>
      <i data-lucide="trash-2" class="text-red-500 cursor-pointer" onclick="deleteProduction(${i})"></i>
     </div>
    </div>
    <div class="text-sm mt-2">
     <p>Machine: ${p.machine}</p>
     <p>Operator: ${p.operator}</p>
     <p>Qty: ${p.qty}</p>
    </div>
   </div>`
 })

 document.getElementById("recordCount").innerText = productions.length
 lucide.createIcons()
}

// OPEN ADD MODAL
function openAddModal(){
 editIndex=null
 modalTitle.innerText="Add Production"
 saveBtn.innerText="ADD"
 date.value = ""
 shift.value = "DAY"
 jobcard.value = ""
 machine.value = "FLAT BED NO 1"
 operator.value = ""
 qty.value = ""
 modal.classList.remove("hidden")
 modal.classList.add("flex") // ✅ center modal
}

// OPEN EDIT MODAL
function openEditModal(i){
 editIndex=i
 let p=productions[i]
 date.value=p.date
 shift.value=p.shift
 jobcard.value=p.jobcard
 machine.value=p.machine
 operator.value=p.operator
 qty.value=p.qty
 modalTitle.innerText="Edit Production"
 saveBtn.innerText="UPDATE"
 modal.classList.remove("hidden")
 modal.classList.add("flex") // ✅ center modal
}

// SAVE ADD / EDIT
function saveProduction(){
 if(!date.value || !jobcard.value || !operator.value || !qty.value){
   alert("Required fields!")
   return
 }

 if(editIndex===null){
  productions.push({
    date: date.value,
    shift: shift.value,
    jobcard: jobcard.value,
    machine: machine.value,
    operator: operator.value,
    qty: qty.value
  })
 }else{
  productions[editIndex]={
    date: date.value,
    shift: shift.value,
    jobcard: jobcard.value,
    machine: machine.value,
    operator: operator.value,
    qty: qty.value
  }
 }
 closeModal()
 renderTable()
}

// DELETE RECORD
function deleteProduction(i){
 if(confirm("Delete this record?")){
  productions.splice(i,1)
  renderTable()
 }
}

// CLOSE MODAL
function closeModal(){
 modal.classList.add("hidden")
 modal.classList.remove("flex")
}

renderTable()
</script>
{% endblock %}
