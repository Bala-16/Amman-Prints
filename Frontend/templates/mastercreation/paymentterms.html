{%extends "nav.html"%}
{%block title%}Payment Terms{%endblock%}
{%block extra_head%}
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{%endblock%}
{%block content%}
<div class="bg-gradient-to-br from-slate-50 via-teal-50/30 to-cyan-50/30 min-h-screen p-6">

<div class="max-w-[1400px] mx-auto space-y-6">

<!-- HEADER -->
<div class="bg-gradient-to-r from-teal-600 to-cyan-600 rounded-xl p-6 flex justify-between items-center">
  <div class="flex items-center gap-3">
    <i data-lucide="credit-card" class="text-white"></i>
    <h1 class="text-2xl font-bold text-white">Payment Terms</h1>
  </div>
  <button onclick="openModal()"
    class="bg-white text-teal-600 px-4 py-2 rounded-lg font-semibold">
    + Add Term
  </button>
</div>

<!-- CHARTS -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
  <div class="bg-white rounded-xl p-4 shadow">
    <h3 class="font-semibold mb-2">Usage Count</h3>
    <div class="h-[200px]">
      <canvas id="barChart"></canvas>
    </div>
  </div>

  <div class="bg-white rounded-xl p-4 shadow">
    <h3 class="font-semibold mb-2">Distribution</h3>
    <div class="h-[200px]">
      <canvas id="pieChart"></canvas>
    </div>
  </div>
</div>

<!-- DESKTOP TABLE -->
<div class="hidden md:block bg-white rounded-xl shadow overflow-x-auto">
<table class="w-full text-sm">
<thead class="bg-slate-100">
<tr>
  <th class="p-3">#</th>
  <th class="p-3 text-left">Term</th>
  <th class="p-3 text-left">Remarks</th>
  <th class="p-3 text-center">Edit</th>
  <th class="p-3 text-center">Delete</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>
</div>

<!-- MOBILE CARDS -->
<div id="cards" class="grid gap-4 md:hidden"></div>

</div>

<!-- MODAL -->
<div id="modal" class="fixed inset-0 bg-black/40 hidden items-center justify-center z-50">
<div class="bg-white rounded-xl w-full max-w-md p-6">
<h2 class="text-lg font-bold mb-4">Payment Term</h2>

<input id="termInput" placeholder="Payment Term"
  class="w-full border p-2 rounded mb-3">

<textarea id="remarksInput" placeholder="Remarks"
  class="w-full border p-2 rounded mb-4"></textarea>

<div class="flex justify-end gap-3">
  <button onclick="closeModal()" class="px-4 py-2 border rounded">Cancel</button>
  <button onclick="saveTerm()" class="px-6 py-2 bg-teal-600 text-white rounded">
    Save
  </button>
</div>
</div>
</div>
</div>
{%endblock%}
{%block extra_js%}
<script>
lucide.createIcons()

let terms = [
 { name:"10 Days", remarks:"" },
 { name:"15 Days", remarks:"" },
 { name:"30 Days", remarks:"" },
 { name:"Immediate", remarks:"" }
]

let editIndex = null
let barChart, pieChart

function renderUI(){
 const tbody = document.getElementById("tableBody")
 const cards = document.getElementById("cards")
 tbody.innerHTML = ""
 cards.innerHTML = ""

 terms.forEach((t,i)=>{
  tbody.innerHTML += `
  <tr class="border-t">
    <td class="p-3">${i+1}</td>
    <td class="p-3 font-medium">${t.name}</td>
    <td class="p-3">${t.remarks || "-"}</td>
    <td class="p-3 text-center text-emerald-600 cursor-pointer"
      onclick="editTerm(${i})">âœï¸</td>
    <td class="p-3 text-center text-red-500 cursor-pointer"
      onclick="deleteTerm(${i})">ğŸ—‘ï¸</td>
  </tr>`

  cards.innerHTML += `
  <div class="bg-white rounded-xl shadow p-4">
    <h3 class="font-bold">${t.name}</h3>
    <p class="text-sm">${t.remarks || "-"}</p>
    <div class="flex justify-end gap-4 mt-3">
      <button onclick="editTerm(${i})" class="text-teal-600">Edit</button>
      <button onclick="deleteTerm(${i})" class="text-red-500">Delete</button>
    </div>
  </div>`
 })

 updateCharts()
}

function openModal(){
 modal.classList.remove("hidden")
 modal.classList.add("flex")
}

function closeModal(){
 modal.classList.add("hidden")
 editIndex = null
 termInput.value = ""
 remarksInput.value = ""
}

function saveTerm(){
 if(!termInput.value.trim()){
  alert("Payment term required")
  return
 }

 const data = {
  name: termInput.value,
  remarks: remarksInput.value
 }

 if(editIndex !== null){
  terms[editIndex] = data
 } else {
  terms.push(data)
 }

 closeModal()
 renderUI()
}

function editTerm(i){
 editIndex = i
 termInput.value = terms[i].name
 remarksInput.value = terms[i].remarks
 openModal()
}

function deleteTerm(i){
 if(confirm("Delete this payment term?")){
  terms.splice(i,1)
  renderUI()
 }
}

function updateCharts(){
 const labels = terms.map(t=>t.name)
 const values = terms.map(()=>1)

 if(barChart) barChart.destroy()
 if(pieChart) pieChart.destroy()

 barChart = new Chart(barChartEl,{
  type:"bar",
  data:{labels,datasets:[{data:values,backgroundColor:"#14b8a6"}]},
  options:{responsive:true,plugins:{legend:{display:false}}}
 })

 pieChart = new Chart(pieChartEl,{
  type:"doughnut",
  data:{labels,datasets:[{data:values}]},
  options:{responsive:true}
 })
}

const barChartEl = document.getElementById("barChart")
const pieChartEl = document.getElementById("pieChart")

renderUI()
</script>

{%endblock%}
