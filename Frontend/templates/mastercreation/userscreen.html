{%extends "nav.html"%}

{%block title%}User Screen{%endblock%}

{%block extra_head%}
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Lucide -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    .modal { display: none; }
    .modal.active { display: flex; }
  </style>
{%endblock%}

{%block content%}

<div class="min-h-screen bg-gradient-to-br from-slate-50 via-teal-50/30 to-cyan-50/30 p-6">

<div class="max-w-[1600px] mx-auto space-y-6">

  <!-- HEADER -->
  <!-- <div class="bg-gradient-to-r from-teal-600 via-cyan-600 to-teal-600 rounded-xl p-6 shadow-xl">
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-2xl font-bold text-white">User Screen</h1>
        <p class="text-teal-50 text-sm">Manage user screens and sub-screens</p>
      </div>

      <button onclick="openAddModal()"
        class="bg-white text-teal-600 px-4 py-2 rounded-lg flex items-center gap-2">
        <i data-lucide="plus"></i>
        New Screen
      </button>
    </div>
  </div> -->
  <!-- HEADER -->
  <div class="bg-gradient-to-r from-teal-600 via-cyan-600 to-teal-600 rounded-xl p-6 shadow-xl">
  <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">

    <div>
      <h1 class="text-2xl font-bold text-white">User Screen</h1>
      <p class="text-teal-50 text-sm">Manage user screens and sub-screens</p>
    </div>

    <button onclick="openAddModal()"
      class="bg-white text-teal-600 px-4 py-2 rounded-lg flex items-center gap-2 w-fit">
      <i data-lucide="plus"></i>
      New Screen
    </button>

  </div>
</div>

  <!-- TABLE (Tablet & Desktop) -->
  <div class="bg-white/80 backdrop-blur-sm rounded-xl shadow-lg overflow-x-auto hidden sm:block">
    <table class="w-full">
      <thead class="bg-slate-50">
        <tr>
          <th class="px-4 py-3 text-left">S.No</th>
          <th class="px-4 py-3 text-left">Screen Name</th>
          <th class="px-4 py-3 text-left">Sub Screen</th>
          <th class="px-4 py-3 text-center">Edit</th>
          <th class="px-4 py-3 text-center">Delete</th>
        </tr>
      </thead>
      <tbody id="screenTable"></tbody>
    </table>
  </div>

  <!-- MOBILE CARDS -->
  <div id="mobileCards" class="sm:hidden space-y-4"></div>

</div>

<!-- MODAL -->
<div id="modal" class="modal fixed inset-0 bg-black/40 backdrop-blur-sm items-center justify-center z-50">
  <div class="bg-white rounded-xl shadow-xl w-full max-w-md p-6">
    <h2 id="modalTitle" class="text-xl font-bold mb-4">User Screen</h2>

    <div class="space-y-4">
      <select id="screenName" class="w-full border h-10 px-3 rounded">
        <option value="">Select</option>
      </select>

      <input id="subScreen" class="w-full border h-10 px-3 rounded" placeholder="Sub Screen"/>
    </div>

    <div class="flex justify-center gap-3 mt-6">
      <button onclick="closeModal()" class="px-6 py-2 border rounded-lg">Cancel</button>
      <button onclick="saveScreen()"
        id="saveBtn"
        class="px-8 py-2 bg-[#9cb916] text-white rounded-lg font-semibold">
        ADD
      </button>
    </div>
  </div>
</div>
</div>
{%endblock%}
{%block extra_js%}
<script>
  const screenNames = [
    "DashBoard","Master Entry","User Type Creation","Party Creation",
    "Unit Measurement","Company Creation","Operator Creation",
    "Consumable Creation","Delivery Module","JobCard Module"
  ]

  let screens = [
    { screen:"Consumable", sub:"Ink Usage Consolidated Report" },
    { screen:"Consumable", sub:"Stock Report" },
    { screen:"DashBoard", sub:"Printing" },
    { screen:"Delivery Module", sub:"Delivery Report" }
  ]

  let editIndex = null

  function renderTable(){
    /* TABLE */
    screenTable.innerHTML = ""
    screens.forEach((s,i)=>{
      screenTable.innerHTML += `
        <tr class="hover:bg-slate-50/50">
          <td class="px-4 py-3">${i+1}</td>
          <td class="px-4 py-3">${s.screen}</td>
          <td class="px-4 py-3">${s.sub}</td>
          <td class="text-center">
            <i data-lucide="edit"
               onclick="openEditModal(${i})"
               class="text-emerald-600 cursor-pointer"></i>
          </td>
          <td class="text-center">
            <i data-lucide="trash-2"
               onclick="deleteScreen(${i})"
               class="text-red-500 cursor-pointer"></i>
          </td>
        </tr>`
    })

    /* MOBILE CARDS */
    mobileCards.innerHTML = ""
    screens.forEach((s,i)=>{
      mobileCards.innerHTML += `
        <div class="bg-white rounded-xl shadow p-4">
          <div class="flex justify-between">
            <div>
              <p class="text-sm text-slate-500">Screen</p>
              <p class="font-semibold">${s.screen}</p>
            </div>
            <div class="flex gap-3">
              <i data-lucide="edit"
                 onclick="openEditModal(${i})"
                 class="text-emerald-600 cursor-pointer"></i>
              <i data-lucide="trash-2"
                 onclick="deleteScreen(${i})"
                 class="text-red-500 cursor-pointer"></i>
            </div>
          </div>
          <div class="mt-2">
            <p class="text-sm text-slate-500">Sub Screen</p>
            <p>${s.sub}</p>
          </div>
        </div>`
    })

    lucide.createIcons()
  }

  function openAddModal(){
    editIndex = null
    modalTitle.innerText = "Add Screen"
    saveBtn.innerText = "ADD"
    screenName.value = ""
    subScreen.value = ""
    modal.classList.add("active")
  }

  function openEditModal(index){
    editIndex = index
    modalTitle.innerText = "Edit Screen"
    saveBtn.innerText = "UPDATE"
    screenName.value = screens[index].screen
    subScreen.value = screens[index].sub
    modal.classList.add("active")
  }

  function saveScreen(){
    if(!screenName.value || !subScreen.value){
      alert("Required fields")
      return
    }

    if(editIndex === null){
      screens.push({ screen:screenName.value, sub:subScreen.value })
    } else {
      screens[editIndex] = { screen:screenName.value, sub:subScreen.value }
    }

    closeModal()
    renderTable()
  }

  function deleteScreen(index){
    if(!confirm("Delete this screen?")) return
    screens.splice(index,1)
    renderTable()
  }

  function closeModal(){
    modal.classList.remove("active")
  }

  screenNames.forEach(n=>{
    screenName.innerHTML += `<option>${n}</option>`
  })

  renderTable()
  lucide.createIcons()
</script>
{%endblock%}



